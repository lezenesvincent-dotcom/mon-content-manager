name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v3
      
    - name: ğŸ”§ Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        
    - name: ğŸ“¦ Cache dependencies
      uses: actions/cache@v3
      with:
        path: ~/.npm
        key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
        
    - name: ğŸ“‹ Create version archive
      run: |
        VERSION=$(date +%Y-%m-%d_%H-%M-%S)
        mkdir -p versions/auto_$VERSION
        cp -r docs/* versions/auto_$VERSION/
        git config user.name "GitHub Actions"
        git config user.email "actions@github.com"
        git add versions/
        git commit -m "ğŸ“¦ Auto-archive version $VERSION" || echo "No changes to archive"
        
    - name: ğŸš€ Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./docs
        force_orphan: false
        
    - name: âœ… Deployment complete
      run: |
        echo "âœ… Deployment successful!"
        echo "ğŸŒ Site: https://lezenesvincent-dotcom.github.io/mon-content-manager/"
